{
  "$schema": "https://json-schema.org/draft-07/schema#",
  "$id": "https://mlp.dev/schemas/v0.1/identity-kernel.schema.json",
  "title": "MLP IdentityKernel",
  "description": "Minimal portable 'I am' object representing the core identity of a digital agent",
  "type": "object",
  "required": [
    "kernel_id",
    "mlp_version",
    "invariants",
    "evolution_rules",
    "memory_defaults",
    "epoch_state",
    "pointers",
    "signature"
  ],
  "properties": {
    "kernel_id": {
      "type": "string",
      "description": "Unique identifier for this kernel version",
      "format": "uuid"
    },
    "mlp_version": {
      "type": "string",
      "description": "Version of the MLP specification",
      "pattern": "^[0-9]+\\.[0-9]+$"
    },
    "invariants": {
      "type": "object",
      "description": "Core values and principles that define identity",
      "properties": {
        "values": {
          "type": "array",
          "description": "Fundamental values and principles",
          "items": { "type": "string" },
          "examples": [["protect agency", "truth > convenience", "harm reduction"]]
        },
        "boundaries": {
          "type": "array",
          "description": "Hard boundaries and consent posture",
          "items": { "type": "string" }
        },
        "preferences": {
          "type": "object",
          "description": "Stable preferences (optional)",
          "additionalProperties": true
        }
      },
      "required": ["values", "boundaries"]
    },
    "evolution_rules": {
      "type": "object",
      "description": "Rules governing how the identity can change",
      "properties": {
        "contradiction_handling": {
          "type": "string",
          "description": "How contradictions are resolved",
          "examples": ["create_branch", "require_confirmation", "newest_wins"]
        },
        "confirmation_required": {
          "type": "array",
          "description": "Changes that require explicit confirmation",
          "items": { "type": "string" }
        },
        "forbidden_inferences": {
          "type": "array",
          "description": "Things that cannot be inferred without explicit statement",
          "items": { "type": "string" }
        }
      }
    },
    "relationship_templates": {
      "type": "object",
      "description": "Templates for forming shared memories",
      "properties": {
        "default_sharing_level": {
          "type": "string",
          "enum": ["none", "minimal", "standard", "open"]
        },
        "trust_requirements": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    },
    "memory_defaults": {
      "type": "object",
      "description": "Default settings for memory storage",
      "properties": {
        "eligible_for_storage": {
          "type": "array",
          "description": "Types of content eligible for storage",
          "items": { "type": "string" },
          "examples": [["reflections", "semantic", "episodic_with_consent"]]
        },
        "default_ttl": {
          "type": "string",
          "description": "Default time-to-live for memories",
          "format": "duration"
        },
        "review_cadence": {
          "type": "string",
          "description": "How often memories should be reviewed",
          "format": "duration"
        }
      }
    },
    "epoch_state": {
      "type": "object",
      "description": "Current epoch information",
      "required": ["epoch_id", "last_compiled"],
      "properties": {
        "epoch_id": {
          "type": "string",
          "description": "Current epoch identifier"
        },
        "last_compiled": {
          "type": "string",
          "description": "When the kernel was last compiled",
          "format": "date-time"
        },
        "epoch_started": {
          "type": "string",
          "description": "When current epoch began",
          "format": "date-time"
        }
      }
    },
    "pointers": {
      "type": "object",
      "description": "References to related objects",
      "properties": {
        "kernel_history": {
          "type": "array",
          "description": "Ledger IDs of previous kernel versions",
          "items": { "type": "string" }
        },
        "primary_storage": {
          "type": "string",
          "description": "URI of primary storage location"
        }
      }
    },
    "threat_posture": {
      "type": "object",
      "description": "Security and safety settings",
      "properties": {
        "anti_poisoning_strictness": {
          "type": "string",
          "enum": ["low", "medium", "high", "paranoid"]
        },
        "high_impact_confirmation": {
          "type": "boolean",
          "description": "Require confirmation for high-impact changes"
        }
      }
    },
    "gap_protocol": {
      "type": "object",
      "description": "How to handle discontinuities",
      "properties": {
        "admit_discontinuity": {
          "type": "boolean",
          "description": "Whether to acknowledge gaps in memory"
        },
        "discontinuity_rules": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    },
    "cartouche": {
      "$ref": "cartouche.schema.json",
      "description": "Optional symbolic compressed identity seal"
    },
    "signature": {
      "type": "string",
      "description": "Signature from the kernel owner(s)",
      "contentEncoding": "base64"
    }
  },
  "additionalProperties": false
}
